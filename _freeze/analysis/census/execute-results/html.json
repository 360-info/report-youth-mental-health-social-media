{
  "hash": "2a8d2cf8b71a52a5309ffc26b537b13a",
  "result": {
    "markdown": "---\ntitle: Mental Health Conditions by Age & Gender \nsubtitle: Analysis and data preparation of data from 2021 ABS Census. \nformat:\n  360-analysis-html: default\nauthor: Dean Marchiori\ndate: last-modified\ncode-fold: true\n---\n\n\n# Mental Health Conditions by Age & Gender  \n\nSetup and load packages. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at /home/wavedatalabs/Documents/wd/report-youth-mental-health-social-media\n```\n:::\n\n```{.r .cell-code}\nlibrary(themes360info)  #360Info internal package: `remotes::install_github(\"360-info/themes360info\")` \n```\n:::\n\n\n## Import Data  \n\nDownload and unzip data. For more information see `./data/README.md`.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!file.exists(here(\"data/raw/ABS_Aus_2021.zip\"))) {\n\n    download.file(\"https://www.abs.gov.au/census/find-census-data/datapacks/download/2021_GCP_AUS_for_AUS_short-header.zip\",\n        destfile = here(\"data/raw/ABS_Aus_2021.zip\")\n    )\n\n    unzip(here(\"data/raw/ABS_Aus_2021.zip\"), exdir = here(\"data/raw/ABS_Aus_2021\"))\n}\n```\n:::\n\n\nRead in the relevant table from the ABS GCP datasets. Table 19 in the GCP is around long term health conditions. \nIt is split across three csv files (A, B, C).  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmh19a <- read_csv(here(\"data/raw/ABS_Aus_2021/2021 Census GCP Australia for AUS/2021Census_G19A_AUS_AUS.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 1 Columns: 201\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (1): AUS_CODE_2021\ndbl (200): M_Arthritis_0_14, M_Arthritis_15_24, M_Arthritis_25_34, M_Arthrit...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nmh19b <- read_csv(here(\"data/raw/ABS_Aus_2021/2021 Census GCP Australia for AUS/2021Census_G19B_AUS_AUS.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 1 Columns: 201\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (1): AUS_CODE_2021\ndbl (200): F_Kidney_disease_0_14, F_Kidney_disease_15_24, F_Kidney_disease_2...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nmh19c <- read_csv(here(\"data/raw/ABS_Aus_2021/2021 Census GCP Australia for AUS/2021Census_G19C_AUS_AUS.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 1 Columns: 21\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (1): AUS_CODE_2021\ndbl (20): P_NS_0_14, P_NS_15_24, P_NS_25_34, P_NS_35_44, P_NS_45_54, P_NS_55...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n## Data Processing  \n\nExtracting Male and Female Mental Health data, and population totals.  \n\nPivoting wider and separating out the ABS column names to decompose gender and age.  \n\nI have calculated *_directional columns to allow plotting like a symmetric age pyramid.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data processing pipeline\nmh <- bind_cols(mh19a, mh19b, mh19c) |>\n    select(\n        AUS_CODE_2021 = AUS_CODE_2021...1,\n        contains(c(\"M_Mental\", \"F_Mental\", \"M_Tot\", \"F_Tot\")),\n        -M_Mental_health_cond_Tot,\n        -F_Mental_health_cond_Tot,\n        -F_Tot_Tot,\n        -M_Tot_Tot\n    ) |>\n    pivot_longer(-AUS_CODE_2021,\n        names_to = \"cat\"\n    ) |> \n    separate_wider_regex(cat,\n        patterns = c(gender = \".\", cond = \"_.+\", age = \"(?<=_)[0-9]+_.+$\"),\n        too_few = \"align_start\"\n    ) |> \n    pivot_wider(names_from = cond) |>\n    rename(\n        Count = `_Mental_health_cond_`,\n        total = `_Tot_`\n    ) |>\n    mutate(\n        Age = str_replace(age, \"_\", \"-\"),\n        Age = fct_recode(Age, `85+` = \"85-over\"),\n        gender = fct_recode(gender, women = \"F\", men = \"M\"),\n    ) |>\n    mutate(\n        `Number of people` = ifelse(gender == \"men\", Count * -1, Count),\n        `Proportion of group` = `Number of people` / total\n    ) |>\n    select(-total, -AUS_CODE_2021, -age, -Count) |>\n    pivot_longer(c(`Number of people`, `Proportion of group`), names_to = \"Series\") |>\n    pivot_wider(names_from = gender, values_from = value) |>\n    mutate(\n        men_tooltip = ifelse(Series == \"Proportion of group\", paste0(abs(round(men * 100, 1)), \"%\"), abs(men)),\n        women_tooltip = ifelse(Series == \"Proportion of group\", paste0(abs(round(women * 100, 1)), \"%\"), abs(women))\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nNew names:\n• `AUS_CODE_2021` -> `AUS_CODE_2021...1`\n• `AUS_CODE_2021` -> `AUS_CODE_2021...202`\n• `AUS_CODE_2021` -> `AUS_CODE_2021...403`\n```\n:::\n:::\n\n\n# Data Export \n\nWrite out data as a csv  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(mh, here(\"data/final/mental_health_census.csv\"))\n```\n:::",
    "supporting": [
      "census_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}